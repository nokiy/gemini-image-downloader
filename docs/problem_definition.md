# Gemini Image Downloader - 问题定义（第一性原理）

> 📅 创建时间：2025-12-23  
> 📌 依据：Popup 报错「请刷新页面后重试」的实际使用场景

---

## 一、现象（用户看到的表层问题）

- 插件弹窗提示「请刷新页面后重试」
- 「下载所有图片」按钮不可用或无法正常下载
- 用户被要求反复刷新页面，任务中断

---

## 二、第一性原理（问题的本质）

### 2.1 用户的根本目标
在尽可能少的步骤内，把 Gemini 对话中 AI 生成的图片转化为**可管理的本地文件**，并保持**最高可用清晰度**。

### 2.2 必须成立的客观事实
- 图片数据存在于当前网页 DOM 或其指向的 CDN 资源中
- Popup 不能直接访问页面内容，必须通过 Content Script 获取图片 URL 与标题
- 浏览器安全边界（权限、注入时机、同源限制）决定了通信链路一旦断裂，下载即无法开始

---

## 三、问题定义（第一性原理表述）

**当扩展无法稳定地从当前 Gemini 页面获取图片 URL 时，用户就无法把 AI 生成图片转为本地文件，核心目标被彻底阻断。**

> 这不是“刷新页面”的问题，而是“**可靠获取页面图片数据**”的问题。

---

## 四、可能触发点（面向排查的假设）

- 单页应用导航导致 Content Script 未注入或未更新
- 页面未完全加载时就触发了 Popup 请求
- 消息通信异常（超时、未响应、权限未匹配）

---

## 五、用户影响

- 任务直接失败（无法下载任何图片）
- 反复刷新造成额外时间成本与挫败感
- 降低对插件稳定性的信任

---

## 六、成功标准（解决问题应达到的状态）

- 打开 Popup 后 3 秒内稳定返回图片数量
- 单次点击即可完成批量下载，无需刷新页面
- 失败时提供可执行的明确原因与恢复路径（而非笼统提示）

